var io_address="http://141.0.170.38:3000",socket=io.connect(io_address),Snakes={},statistics=[],current_room="",killed=null,glob_snake_name=null;window.onload=function(){socket.emit("rooms_statistics");socket.on("data",function(c){var b=+new Date();for(var a in c){if(Snakes[c[a].socket_id]){Snakes[c[a].socket_id].move(c[a].direction);Snakes[c[a].socket_id].timestamp=b}}for(var a in Snakes){if(Snakes[a].timestamp!==b){Snakes[a].move(Snakes[a].current_direction);Snakes[a].timestamp=b}}});socket.on("message",function(a){if(a){document.getElementById("room_error").innerHTML=a}});socket.on("join_status",function(a){console.log("join_status",a);if(a!=1){document.getElementById("show_error").style.display="block";switchScreen(1)}});socket.on("leave_status",function(a){console.log(a)});socket.on("rooms_statistics",function(a){room1=document.getElementById("room1").innerHTML=a[0].name;document.getElementById("roomname1").innerHTML=a[0].name;document.getElementById("roomdescription1").innerHTML=a[0].description;document.getElementById("current_players1").innerHTML=a[0].current_players;document.getElementById("max_players1").innerHTML=a[0].max_players;room2=document.getElementById("room2").innerHTML=a[1].name;document.getElementById("roomname2").innerHTML=a[1].name;document.getElementById("roomdescription2").innerHTML=a[1].description;document.getElementById("current_players2").innerHTML=a[1].current_players;document.getElementById("max_players2").innerHTML=a[1].max_players;room3=document.getElementById("room3").innerHTML=a[2].name;document.getElementById("roomname3").innerHTML=a[2].name;document.getElementById("roomdescription3").innerHTML=a[2].description;document.getElementById("current_players3").innerHTML=a[2].current_players;document.getElementById("max_players3").innerHTML=a[2].max_players;statistics=a});socket.on("coordinates",function(d){console.log("coordinates",d);var b=["yellow","red","blue","green","yellow"];var a=0;for(var c in d){if(Snakes[d[c].socket_id]){a++;continue}Snakes[d[c].socket_id]=new Snake();Snakes[d[c].socket_id].init();Snakes[d[c].socket_id].id=d[c].socket_id;Snakes[d[c].socket_id].color=b[a%b.length];Snakes[d[c].socket_id].generate_whole_snake(d[c].snake);a++}});socket.on("grow",function(a){Snakes[a.snake].grow+=a.value});socket.on("death",function(b){console.log("death",b,socket);if(socket.io.engine.id===b){killed=1;document.getElementById("snakediv").style.display="none";document.getElementById("death_screen").style.display="block";document.getElementById("stats").style.display="block"}if(Snakes[b].snake.length>0){document.getElementById("stats").innerHTML="Your snake: <strong>"+glob_snake_name+"</strong> scrored "+(Snakes[b].snake.length-4)+" points.";for(var a in Snakes[b].snake){while(document.getElementsByClassName(b).length){document.getElementsByClassName(b)[0].parentNode.removeChild(document.getElementsByClassName(b)[0])}}delete Snakes[b]}});socket.on("food",function(b){while(document.getElementsByClassName("food").length){document.getElementsByClassName("food")[0].remove()}for(var a in b){document.getElementById("snakediv").innerHTML=document.getElementById("snakediv").innerHTML+'<div class="food food'+b[a].value+'" style="top: '+b[a].y*20+"px; left: "+b[a].x*20+'px;" data-value="'+b[a].value+'">&nbsp;</div>'}})};function startGame(){if(current_room){switchScreen(2);glob_snake_name=document.getElementById("snake_name").value;socket.emit("joinRoom",{room:current_room});window.addEventListener("keydown",function(b){if(killed===1){return true}var a=b.keyCode>=37&&b.keyCode<=40;switch(b.keyCode){case 37:case 65:case 100:socket.emit("move","left");break;case 38:case 87:case 104:socket.emit("move","up");break;case 39:case 68:case 102:socket.emit("move","right");break;case 40:case 83:case 98:socket.emit("move","down");break}if(a){b.preventDefault()}return !a})}}function leaveGame(){if(current_room){window.location.href=window.location.href}}function joinRoom(b){if(b){room=statistics.filter(function(c){return c.name===b})[0];if(room){current_room=b;switchScreen(1);snakediv=document.getElementById("snakediv");snakediv.style.display="block";snakediv.style.width=room.gridx*20+"px";snakediv.style.height=room.gridy*20+"px";var a="background_800_500 board_screen";if((room.gridx*20)===1000){a="background_1000_800 board_screen"}else{if((room.gridx*20)===1600){a="background_1600_800 board_screen"}}snakediv.className=a}}}function switchScreen(a){input_screen=document.getElementById("input_screen");leave_screen=document.getElementById("leave_screen");input_screen.style.display="none";leave_screen.style.display="none";if(a===1){input_screen.style.display="block"}else{if(a===2){begin_screen.style.visibility="hidden";leave_screen.style.display="block"}}}function leaveRoom(){socket.emit("leaveRoom",{room:"Noobs"})};function Snake(){this.id=null;this.box=null;this.box_side=20;this.snake=[];this.current_direction=null;this.grow=0;this.last_direction=null;this.color=null;this.lastcorection=[];this.tailclass=null;this.init=function(){this.box=document.getElementById("snakediv")};this.generate_pixel=function(a,d,b){var c="sss_left_right_"+this.color;if(this.current_direction==="up"||this.current_direction==="down"){c="sss_top_down_"+this.color}this.box.innerHTML=this.box.innerHTML+'<div class="'+c+" "+this.id+'" style="top: '+d*this.box_side+"px; left: "+a*this.box_side+'px;">&nbsp;</div>';if(b){this.snake.push({x:a,y:d})}else{this.snake.unshift({x:a,y:d})}};this.rotateSnake=function(b,a){var c="sss_left_right_"+this.color;if(this.current_direction==="up"||this.current_direction==="down"){c="sss_top_down_"+this.color}if(a){if(b>0){document.getElementsByClassName(this.id)[b-1].className=c+" "+this.id}else{document.getElementsByClassName(this.id)[1].className=c+" "+this.id}c="sss_head_"+this.color}if(b>0){document.getElementsByClassName(this.id)[0].className=this.tailclass+" "+this.id}else{document.getElementsByClassName(this.id)[this.snake.length-1].className=this.tailclass+" "+this.id}document.getElementsByClassName(this.id)[b].className=c+" "+this.id};this.rotateTail=function(){if(this.lastcorection.length>0){if((this.snake[this.snake.length-1].x===this.lastcorection[0][0])&&(this.snake[this.snake.length-1].y===this.lastcorection[0][1])){this.lastcorection.pop();this.tailclass="sss_tail_left";if(this.current_direction==="up"){this.tailclass="sss_tail_up"}else{if(this.current_direction==="down"){this.tailclass="sss_tail_down"}else{if(this.current_direction==="right"){this.tailclass="sss_tail_right"}}}document.getElementsByClassName(this.id)[0].className=this.tailclass+" "+this.id}}else{this.tailclass="sss_tail_left";if(this.current_direction==="up"){this.tailclass="sss_tail_up"}else{if(this.current_direction==="down"){this.tailclass="sss_tail_down"}else{if(this.current_direction==="right"){this.tailclass="sss_tail_right"}}}}};this.remove_pixel=function(){this.box.removeChild(this.box.getElementsByClassName(this.id)[0]);this.rotateTail();this.snake.pop()};this.generate_snake=function(d,c){if(d.x<=c.x){if(d.y<=c.y){for(var a=d.x;a<=c.x;a++){for(var b=d.y;b<=c.y;b++){this.generate_pixel(a,b,true)}}}else{for(var a=d.x;a<=c.x;a++){for(var b=d.y;b>=c.y;b--){this.generate_pixel(a,b,true)}}}}else{if(d.y<=c.y){for(var a=d.x;a>=c.x;a--){for(var b=d.y;b<=c.y;b++){this.generate_pixel(a,b,true)}}}else{for(var a=d.x;a>=c.x;a--){for(var b=d.y;b>=c.y;b--){this.generate_pixel(a,b,true)}}}}this.set_current_direction();this.rotateSnake(0)};this.generate_whole_snake=function(b){for(var a=b.length-1;a>=0;a--){this.generate_pixel(b[a].x,b[a].y,false)}this.set_current_direction();this.rotateSnake(0)};this.move=function(a){if(a===this.get_opposite_direction()){a=this.current_direction}switch(a){case"up":this.move_head(0,-1);this.move_tail();break;case"down":this.move_head(0,1);this.move_tail();break;case"right":this.move_head(1,0);this.move_tail();break;case"left":this.move_head(-1,0);this.move_tail();break}this.set_current_direction();this.rotateSnake(this.snake.length-1,1)};this.move_head=function(a,d){var b=this.snake[0],c={x:b.x+a,y:b.y+d};this.generate_pixel(c.x,c.y,false)};this.move_tail=function(){if(this.grow){this.grow--;this.rotateTail()}else{this.remove_pixel()}};this.set_current_direction=function(){this.last_direction=this.current_direction;var b=this.snake[0],a=this.snake[1];if(b.x>a.x){this.current_direction="right"}else{if(b.x<a.x){this.current_direction="left"}else{if(b.y<a.y){this.current_direction="up"}else{if(b.y>a.y){this.current_direction="down"}}}}if((this.last_direction!=null)&&(this.last_direction!=this.current_direction)){this.lastcorection.push([b.x,b.y])}};this.get_opposite_direction=function(){var a=null;switch(this.current_direction){case"up":a="down";break;case"down":a="up";break;case"right":a="left";break;case"left":a="right";break}return a}};